<%= form_with model: [@assignment, @test], local: true do |form| %>
    <div class="form-grid w-100 h-100">
        <div class="d-flex align-items-center justify-content-center">
            <div class="form-group w-50">
                <%= form.label :name %>
                <%= form.text_field :name, class:"form-control" %>
            </div>
        </div>

		<hr>

		<div class="test-metadata d-flex">
			<div class="form-group w-33">
				<%= form.label :test_grouping_position, "Group Number" %>
				<%= form.text_field :test_grouping_position, class: "form-control" %>
			</div>

			<div class="form-group w-33">
				<%= form.label :points %>
				<%= form.number_field :points, class:"form-control" %>
			</div>

			<div class="form-group w-33">
				<%= form.label :position %>
				<%= form.text_field :position , class:"form-control"%>
			</div>
		</div>

		<hr>

        <div class="static-test-info align-items-center d-flex justify-content-space-evenly">
            <div class="form-group align-items-center justify-content-space-evenly">
                <div class="form-group">
                <%= form.label :test_type %>
                    <% if @test.persisted? %>
                    <%= form.text_field :test_type, class: "form-control", readonly: true %>
                    <% else %>
                    <%= form.select :test_type, options_for_select(
                        [['coverage', 'coverage'],
                        ['compile', 'compile'],
                        ['approved_includes', 'approved_includes'],
                        ['memory_errors', 'memory_errors'],
                        ['unit', 'unit'],
                        ['i_o', 'i_o'],
                        ['performance', 'performance'],
                        ['script', 'script']],
                        @test.test_type),
                        { include_blank: 'Please select a test type' },
                        onchange: "loadTestPartial(this.value)",
                        class: "form-control" %>
                    <% end %>
                </div>
                <div class="form-group">
                    <%= form.label :target %>
                    <%= form.text_field :target, class:"form-control" %>
                </div>
                <div class="form-group d-flex">
                    <div class="form-group w-50 d-flex align-items-center">
                        <%= form.check_box :show_output %>
                        <%= form.label :show_output, class: 'ml-2' %>
                    </div>
                    <div class="form-group w-50 d-flex align-items-center">
                        <%= form.check_box :skip %>
                        <%= form.label :skip, class: 'ml-2' %>
                    </div>
                </div>
                <div class="form-group">
                    <%= form.label :timeout %>
                    <%= form.number_field :timeout, class:"form-control" %>
                </div>
            </div>
            <div class="form-group align-items-center justify-content-space-evenly h-75">
                <div class="form-group flex-grow-1 h-75">
                    <%= form.label :include %>
                    <%= form.text_area :include , class:"form-control includes"%>
                </div>
                <div class="field">
                    <%= form.label :visibility %>
                    <%= form.select :visibility, options_for_select(
                        [['Hidden', 'hidden'],
                        ['After Due Date', 'after_due_date'],
                        ['After Published', 'after_published'],
                        ['Visible', 'visible']], @test.visibility || 'visible'),
                        class:"form-control" %>
                </div>
            </div>
        </div>

        <hr>

        <div id="dynamic-test-block-container">
            <% if @test.test_type.present? %>
            <%= render "assignments/test_blocks/#{@test.test_type}", form: form , test: @test %>
            <% end %>
        </div>

        <div class="form-actions">
            <%= form.submit @test.persisted? ? "Update Test" : "Create Test" , class:"btn btn-primary"%>
        </div>
    </div>
<% end %>

<% if @test.persisted? %>
  <div class="delete-actions">
    <%= button_to "Delete Test", assignment_test_path(@assignment, @test), method: :delete, data: { confirm: "Are you sure?", turbo: false }, class: "btn btn-danger" %>
  </div>
<% end %>

